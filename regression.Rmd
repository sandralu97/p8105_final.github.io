---
title: "Regression Analysis"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r include = FALSE}
library(tidyverse)
library(httr)
library(lubridate)
library(geepack)

# setting
theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d

# Read data
covid_df = read.csv("./data/covid.csv") 
poll_df = read_csv("./data/state_poll_20.csv") %>% 
  drop_na() 
  

covid_df = covid_df %>% mutate(
  date = as.Date(date)
)


# function that outputs covid df in the interval

match = function(interval, state_name) {
  covid_df %>%
    filter(state == state_name) %>% 
    mutate(logic = date %within% interval) %>% 
    filter(logic == TRUE)
}

# function that generates means of case, death, postive increase, and death increase

mean_value = function(df){
  tibble(
    mean_case = mean(df$total_case),
    mean_death = mean(df$death),
    mean_pos_increase = mean(df$positive_increase),
    mean_death_increase = mean(df$death_increase),
  ) 
}

# Create the regression df

poll_covid_df = 
  poll_df %>% 
  mutate(
    interval = interval(ymd(start_date), ymd(end_date)),
    covid_list = map2(.x = interval, .y = state, ~ match(.x, .y)),
    mean_outputs = map(.x = covid_list, ~ mean_value(.x))
  ) %>% 
  select(state, biden, biden_lead, mean_outputs) %>% 
  unnest(mean_outputs) 

poll_covid_df =
  poll_covid_df %>% 
  mutate(
    id = min_rank(state)
  )

```

\

# Overview

***

In the regression analysis, we found that Trump was more "benefiting" from COVID-19. In contrary, the supporting rate of Biden was decreasing as the COVID-19 pandemic progress. This could be due to the **"rally round the flag" effect**, which illustrates the phenomenon that there is a short-term surge of voter approval of present nation leader during a crisis or emergency situation.

\

# Research question

***

In this part, we aimed to examine the relationship between COVID-19 case / death rate and presidential poll by different battleground states. Since the COVID-19 statistics was a longitudinal measurement over time, generalized estimating equations (GEE) model was used to account for correlated data within each state. 

\ 

## Distribution of Outcome: Biden's spread of points over Trump

* `biden_lead` the difference between the supporting rate of Biden and Trump during the poll survey period

```{r}

ggplot(data = poll_covid_df, aes(x = biden_lead)) +
  geom_density() + 
  xlab("Biden's spread of points over Trump")

```

\

## Explainatory variables

* `mean_case` the average number of incremental COVID-19 cases between the poll survey period

* `mean_death` the average number of incremental COVID-19 death between the poll survey period

* `mean_pos_increase` the average number of daily COVID-19 cases increased comparing to previous day between the poll survey period

* `mean_death_increase` the average number of daily COVID-19 death increased comparing to previous day between the poll survey period

\

# Result

***

Estimates from GEE modelling:

1. _Biden lead = β0 + β1(COVID case)_

```{r}
# Model mean_case
model_case = 
poll_covid_df %>% 
  drop_na(mean_case, biden_lead)

geeglm(biden_lead ~ mean_case,
       data = model_case,
       id = id,
       family = gaussian(link = "identity"),
       corstr = "exchangeable"
       ) %>%   
  broom::tidy() %>% 
  knitr::kable()

```

2. _Biden lead = β0 + β1(COVID death)_

```{r}
# Model mean_death
model_death = 
poll_covid_df %>% 
  drop_na(mean_death, biden_lead)


  geeglm(biden_lead ~ mean_death,
         data = model_death,
         id = id,
         family = gaussian(link = "identity"),
         corstr = "exchangeable"
         ) %>%   
  broom::tidy() %>% 
  knitr::kable()
```
 
3. _Biden lead = β0 + β1(COVID case increase)_

```{r}
# case increase
model_case_increase = 
poll_covid_df %>% 
  drop_na(mean_pos_increase, biden_lead)


  geeglm(biden_lead ~ mean_pos_increase,
         data = model_case_increase,
         id = id,
         family = gaussian(link = "identity"),
         corstr = "exchangeable"
         ) %>%   
  broom::tidy() %>% 
  knitr::kable()
```

4. _Biden lead = β0 + β1(COVID death increase)_

```{r}
# death increase
model_death_increase = 
poll_covid_df %>% 
  drop_na(mean_death_increase, biden_lead)


  geeglm(biden_lead ~ mean_death_increase,
         data = model_death_increase,
         id = id,
         family = gaussian(link = "identity"),
         corstr = "exchangeable"
         ) %>%   
  broom::tidy() %>% 
  knitr::kable()
```


# Findings
***

Based on the regression analysis, we have concluded that:

1. As COVID-19 cases increase, Biden supporting rate decrease within each battleground state.

2. As COVID-19 death increase, Biden supporting rate decrease within each battle ground state.

3. COVID-19 daily case / daily death was not correlated with Biden supporting rate

\

# Discussion

***

Interestingly, Biden supporting rate decreased by increase of COVID-19 cases and death over time. In other word, Trump supporting rate was increasing. This may be due the **"rally round the flag" effect**.

"Rally round the flag" effect is when there is a short-term surge of voter approval of present nation leader during a crisis or emergency situation. One of the most well-known example is during the 9-11 terrorist attack in 2001. The approval rate of President George W. Bush increased by 39% (from 51% to 90%).

According to [Dickinson (2020)](https://sites.middlebury.edu/presidentialpower/2020/03/28/trump-covid-19-and-the-rally-round-the-flag-phenomenon/), the main reason for this effect is the presidents' relatively unique position in the American political system. Presidents is the only individual embodiment of the nation besides the partisan position. Therefore, the president can benefit from his stature as political head of government when circumstances threaten the nation.

He also pointed out that voters who are less politically aware are more responsive to the "rally round the flag" effect, which may be the majority of battleground state voter. Those partisan members are more likely to be ideological.

During the 2020 COVID-19 pandemic, this effect was also observed in several other countries including Australia, Canada, Germany, Britain, India, France, etc. 